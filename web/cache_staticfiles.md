### 关于静态文件的缓存和更新

目标是可以设置静态文件的缓存时间为最大值，而通过文件名或其他手段来在版本更新部署后获取到最新的文件。

目前的做法选择（以django后端为例）：

想了一些实现的思路，使用get参数的方法就不考虑了。因为存在与rename方式同样的限制（css、js文件中的引用资源），却有不可的缺陷：部署html和部署静态文件之间时间差造成的请求出错。

rename方式得以避免这个问题的前提是要求静态文件要比html文件先部署到生产环境中。而对当前使用git pull一股脑部署的方式来说，做不到这一点。html文件总是会比新静态文件先存在于环境里！！！要做到完美，部署方式必须改变。

整个过程大概分解成：

1. 确定发布版本时所有静态文件（css/js/img）的文件名(with hash)。
	
	可以通过gulp插件得到所有静态文件和目标文件名的映射关系＝> 得到一个manifest.json文件。
	
2. 提交代码。

3. 拉取新的静态文件后，在生产服务器上生成所需的文件名带hash的静态文件。

2. 在html，css，js文件中使用这些文件名。

	在html中替换文件名这个动作可以是动态的，通过诸如模版标签的手段，直到渲染模版时才确认文件名。
	
	但是css和js这些文件里的引用资源必须在新的html文件存在之前通过硬修改实现。（注意这里并不要求css和js依赖的文件必须比它们先存在于生产服务器上，因为部署新的静态文件是先于新html文件的，所以在所有静态文件部署好前，新的css和js代码不会被加载，也就不会导致请求不到新的依赖文件）
	
	如果在这一步也硬修改html代码，那就要求这里的html代码存放路径不能和实际生产目录一致。

4. 拉取所有更新代码，重启服务。
	
